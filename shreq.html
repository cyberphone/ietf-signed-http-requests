<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="creator" content="rfcmarkup version 1.129b" />
    <link rel="schema.DC" href="http://purl.org/dc/elements/1.1/" />

    <link rel="icon" href="" type="image/png" />
    <link rel="shortcut icon" href="" type="image/png" />
    <title>draft-rundgren-signed-http-requests-2.txt - Signed HTTP Requests (SHREQ)</title>
    
    
    <style type="text/css">
	@media only screen 
	  and (min-width: 992px)
	  and (max-width: 1199px) {
	    body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 768px)
	  and (max-width: 991px) {
            body { font-size: 14pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-width: 480px)
	  and (max-width: 767px) {
            body { font-size: 11pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (max-width: 479px) {
            body { font-size: 8pt; }
            div.content { width: 96ex; margin: 0 auto; }
        }
	@media only screen 
	  and (min-device-width : 375px) 
	  and (max-device-width : 667px) {
            body { font-size: 9.5pt; }
            div.content { width: 96ex; margin: 0; }
        }
	@media only screen 
	  and (min-device-width: 1200px) {
            body { font-size: 10pt; margin: 0 4em; }
            div.content { width: 96ex; margin: 0; }
        }
        h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 {
	    font-weight: bold;
            line-height: 0pt;
            display: inline;
            white-space: pre;
            font-family: monospace;
            font-size: 1em;
	    font-weight: bold;
        }
        pre {
            font-size: 1em;
            margin-top: 0px;
            margin-bottom: 0px;
        }
	.pre {
	    white-space: pre;
	    font-family: monospace;
	}
	.header{
	    font-weight: bold;
	}
        .newpage {
            page-break-before: always;
        }
        .invisible {
            text-decoration: none;
            color: white;
        }
        a.selflink {
          color: black;
          text-decoration: none;
        }
        @media print {
            body {
                font-family: monospace;
                font-size: 10.5pt;
            }
            h1, h2, h3, h4, h5, h6 {
                font-size: 1em;
            }
        
            a:link, a:visited {
                color: inherit;
                text-decoration: none;
            }
            .noprint {
                display: none;
            }
        }
	@media screen {
	    .grey, .grey a:link, .grey a:visited {
		color: #777;
	    }
            .docinfo {
                background-color: #EEE;
            }
            .top {
                border-top: 7px solid #EEE;
            }
            .bgwhite  { background-color: white; }
            .bgred    { background-color: #F44; }
            .bggrey   { background-color: #666; }
            .bgbrown  { background-color: #840; }            
            .bgorange { background-color: #FA0; }
            .bgyellow { background-color: #EE0; }
            .bgmagenta{ background-color: #F4F; }
            .bgblue   { background-color: #66F; }
            .bgcyan   { background-color: #4DD; }
            .bggreen  { background-color: #4F4; }

            .legend   { font-size: 90%; }
            .cplate   { font-size: 70%; border: solid grey 1px; }
	}
    </style>
    <!--[if IE]>
    <style>
    body {
       font-size: 13px;
       margin: 10px 10px;
    }
    </style>
    <![endif]-->

    <script type="text/javascript"><!--
    function addHeaderTags() {
	var spans = document.getElementsByTagName("span");
	for (var i=0; i < spans.length; i++) {
	    var elem = spans[i];
	    if (elem) {
		var level = elem.getAttribute("class");
                if (level == "h1" || level == "h2" || level == "h3" || level == "h4" || level == "h5" || level == "h6") {
                    elem.innerHTML = "<"+level+">"+elem.innerHTML+"</"+level+">";		
                }
	    }
	}
    }
    var legend_html = "Colour legend:<br />      <table>         <tr><td>Unknown:</td>                   <td><span class='cplate bgwhite'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft:</td>                     <td><span class='cplate bgred'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Informational:</td>             <td><span class='cplate bgorange'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Experimental:</td>              <td><span class='cplate bgyellow'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Best Common Practice:</td>      <td><span class='cplate bgmagenta'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Proposed Standard:</td>         <td><span class='cplate bgblue'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Draft Standard (old designation):</td> <td><span class='cplate bgcyan'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Internet Standard:</td>         <td><span class='cplate bggreen'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Historic:</td>                  <td><span class='cplate bggrey'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>         <tr><td>Obsolete:</td>                  <td><span class='cplate bgbrown'>&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr>     </table>";
    function showElem(id) {
        var elem = document.getElementById(id);
        elem.innerHTML = eval(id+"_html");
        elem.style.visibility='visible';
    }
    function hideElem(id) {
        var elem = document.getElementById(id);
        elem.style.visibility='hidden';        
        elem.innerHTML = "";
    }
    // -->
    </script>
</head>
<body onload="addHeaderTags()">
  <div class="content">
   <div style="height: 13px;">
      <div onmouseover="this.style.cursor='pointer';"
         onclick="showElem('legend');"
         onmouseout="hideElem('legend')"
	 style="height: 6px; position: absolute;"
         class="pre noprint docinfo "
         title="Click for colour legend." >                                                                        </div>
      <div id="legend"
           class="docinfo noprint pre legend"
           style="position:absolute; top: 4px; left: 4ex; visibility:hidden; background-color: white; padding: 4px 9px 5px 7px; border: solid #345 1px; "
           onmouseover="showElem('legend');"
           onmouseout="hideElem('legend');">
      </div>
   </div>

<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<span class="pre noprint docinfo">                                                                        </span><br />
<pre>
Network Working Group                                        A. Rundgren
Internet-Draft                                               Independent
Intended status: Standards Track                       February 18, 2019
Expires: August 22, 2019


                      <span class="h1">Signed HTTP Requests (SHREQ)</span>
                 <span class="h1">draft-rundgren-signed-http-requests-00</span>

Abstract

   The SHREQ specification describes how JCS [<a href="#ref-JCS" title="&quot;JSON Canonicalization Scheme - Work in progress&quot;">JCS</a>] combined with JWS
   [<a href="http://tools.ietf.org/html//rfc7515" title="&quot;JSON Web Signature (JWS)&quot;">RFC7515</a>], can be utilized to support HTTP [<a href="http://tools.ietf.org/html//rfc7231" title="&quot;Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content&quot;">RFC7231</a>] based
   applications needing digitally signed requests.  SHREQ is
   specifically tailored for Web applications using JSON [<a href="http://tools.ietf.org/html//rfc8259" title="&quot;The JavaScript Object Notation (JSON) Data Interchange Format&quot;">RFC8259</a>] as
   message format.  However, there is also a SHREQ scheme for HTTP
   requests that do not have a message body like "GET".  SHREQ was
   designed to be agnostic with respect to the use of REST [<a href="#ref-REST" title="&quot;Architectural Styles and the Design of Network-based Software Architectures&quot;">REST</a>]
   concepts versus more traditional GET/POST schemes.

   The intended audiences of this document are Web tool vendors, as well
   as designers of secure Web applications.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of <a href="http://tools.ietf.org/html//bcp78">BCP 78</a> and <a href="http://tools.ietf.org/html//bcp79">BCP 79</a>.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at <a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a>.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on August 22, 2019.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to <a href="http://tools.ietf.org/html//bcp78">BCP 78</a> and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (<a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a>) in effect on the date of



<span class="grey">Rundgren                 Expires August 22, 2019                [Page 1]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-2" id="page-2" href="#page-2" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   <a href="#section-1">1</a>.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-2">2</a>
   <a href="#section-2">2</a>.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
   <a href="#section-3">3</a>.  POST, PUT and PATCH Requests  . . . . . . . . . . . . . . . .   <a href="#page-3">3</a>
     <a href="#section-3.1">3.1</a>.  Request Creation  . . . . . . . . . . . . . . . . . . . .   <a href="#page-4">4</a>
     <a href="#section-3.2">3.2</a>.  Request Validation  . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
   <a href="#section-4">4</a>.  GET and DELETE Requests . . . . . . . . . . . . . . . . . . .   <a href="#page-5">5</a>
     <a href="#section-4.1">4.1</a>.  Request Creation  . . . . . . . . . . . . . . . . . . . .   <a href="#page-6">6</a>
     <a href="#section-4.2">4.2</a>.  Request Validation  . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-5">5</a>.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-6">6</a>.  Security Considerations . . . . . . . . . . . . . . . . . . .   <a href="#page-7">7</a>
   <a href="#section-7">7</a>.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
   <a href="#section-8">8</a>.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-8.1">8.1</a>.  Normative References  . . . . . . . . . . . . . . . . . .   <a href="#page-8">8</a>
     <a href="#section-8.2">8.2</a>.  Informal References . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#appendix-A">Appendix A</a>.  Optional SHREQ Headers . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
   <a href="#appendix-B">Appendix B</a>.  Other Signed HTTP Request Solutions  . . . . . . . .   <a href="#page-9">9</a>
     <a href="#appendix-B.1">B.1</a>.  Amazon Web Services . . . . . . . . . . . . . . . . . . .   <a href="#page-9">9</a>
     <a href="#appendix-B.2">B.2</a>.  HTTP Signatures . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#appendix-B.3">B.3</a>.  Open Banking (UK) . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
     <a href="#appendix-B.4">B.4</a>.  Financial API . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-10">10</a>
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .  <a href="#page-11">11</a>

<span class="h2"><a class="selflink" name="section-1" href="#section-1">1</a>.  Introduction</span>

   Currently there is no standard for digitally signing HTTP [<a href="http://tools.ietf.org/html//rfc7231" title="&quot;Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content&quot;">RFC7231</a>]
   requests.  This has lead to the development of a multitude of
   proprietary solutions (see <a href="#appendix-B">Appendix B</a>), typically building on using
   HTTP header data for holding security constructs, while JSON request
   data is provided in clear in the HTTP body.

   SHREQ is intended to provide a standardized alternative that also
   fully honors the REST concept without (directly) using HTTP headers
   for holding security constructs.  That is, JSON message data is
   supposed to also contain the security portion of a message.  This
   arrangement has the following characteristics:

   o  Since REST requests (as a minimum) also are defined by the HTTP
      URI and HTTP Verb these attributes are added as reserved JSON
      properties to the signed request data.



<span class="grey">Rundgren                 Expires August 22, 2019                [Page 2]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-3" id="page-3" href="#page-3" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   o  Due to the fact that messages compliant with this specification
      constitute of self-contained JSON objects, they may be serialized
      in databases or be embedded in other JSON objects.  The latter
      includes supporting counter signatures.

   o  The use of canonicalization provided by JCS makes signatures
      remain valid also after being processed by arbitrary JSON
      compliant tools.

   o  JWS is used in detached mode without modifications or extensions.

   o  For general interoperability concerns as well as due to the
      reliance on JCS, JSON message data is limited to the I-JSON
      [<a href="http://tools.ietf.org/html//rfc7493" title="&quot;The I-JSON Message Format&quot;">RFC7493</a>] subset.

   The above applies to HTTP requests using the methods "POST", "PUT" or
   "PATCH" described in <a href="#section-3">Section 3</a>.

   For HTTP requests using the methods "GET" or "DELETE" there is
   another, entirely URI [<a href="http://tools.ietf.org/html//rfc3986" title="&quot;Uniform Resource Identifier (URI): Generic Syntax&quot;">RFC3986</a>] based scheme described in <a href="#section-4">Section 4</a>.

<span class="h2"><a class="selflink" name="section-2" href="#section-2">2</a>.  Terminology</span>

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in <a href="http://tools.ietf.org/html//bcp14">BCP</a>
   <a href="http://tools.ietf.org/html//bcp14">14</a> [<a href="http://tools.ietf.org/html//rfc2119" title="&quot;Key words for use in RFCs to Indicate Requirement Levels&quot;">RFC2119</a>] [<a href="http://tools.ietf.org/html//rfc8174" title="&quot;Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words&quot;">RFC8174</a>] when, and only when, they appear in all
   capitals, as shown here.

<span class="h2"><a class="selflink" name="section-3" href="#section-3">3</a>.  POST, PUT and PATCH Requests</span>

   Assume you have an unsigned HTTP request like the following:

     POST /transact/pay HTTP/1.1
     Host: example.com
     Content-Type: application/json
     Content-Length: 1234

     {
       "something": "data",

            Additional application specific properties

     }

   Adding a signature to this request would require the following
   enhancements to the JSON payload:




<span class="grey">Rundgren                 Expires August 22, 2019                [Page 3]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-4" id="page-4" href="#page-4" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


     {
       "@req.uri": "https://example.com/transact/pay",
       "@req.vrb": "POST",
       "something": "data",

            Additional application specific properties

       "@req.jws": "eyJhbGciOiJIUzI1NiJ9..VHVItCBCb849imarDtjw4"
     }

   Notes:

   o  The argument to "@req.jws" (a detached JWS) was truncated for
      brevity.

   o  This specification presumes that JSON data ("payload") is
      expressed through a top level JSON Object.

   o  The "@req.vrb" property is actually redundant since the HTTP
      method "POST" is default.

   The following subsections detail the operation for requests having an
   HTTP body.

<span class="h3"><a class="selflink" name="section-3.1" href="#section-3.1">3.1</a>.  Request Creation</span>

   For compliance with this specification the following properties MUST
   be be added to the JSON Object to be signed (unless they are optional
   in the specific request scenario):

   @req.uri
      REQUIRED property holding the complete target URI.

   @req.vrb
      OPTIONAL property holding the HTTP method in uppercase.  If this
      property is missing, the HTTP method "POST" is assumed.

   @req.hdr
      OPTIONAL property holding a JSON object with HTTP headers related
      to the message.  For more information see <a href="#appendix-A">Appendix A</a>.

   @req.jws
      REQUIRED property holding a detached JWS signature calculated over
      the rest of the JSON payload using the method described in
      [<a href="#ref-JWSJCS" title="&quot;Combined JWS and JCS Signature Scheme - Work in progress&quot;">JWSJCS</a>].  Note that this property MUST be created and added after
      all other properties have been inserted in the JSON Object.





<span class="grey">Rundgren                 Expires August 22, 2019                [Page 4]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-5" id="page-5" href="#page-5" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   Since these property names are reserved they MUST NOT be used for
   other purposes in applications whishing to use this specification.

<span class="h3"><a class="selflink" name="section-3.2" href="#section-3.2">3.2</a>.  Request Validation</span>

   In addition to normal validation of received data, the following
   steps MUST also be performed:

   1.  The arguments to "@req.uri", "@req.vrb" and "@req.jws" MUST be
       verified for correctness which usually only can be done by the
       service processing the request.  If there is a mismatch the
       service MUST reject the request with an HTTP code 400 (Malformed
       request).

   2.  Extract the "JWS Protected Header" and "JWS Signature" from the
       JWS object recieved in "@req.jws".

   3.  If the algorithm or key (optionally) specified in the
       "JWS Protected Header" do not match the service's expectations or
       requirements, reject the request with an HTTP code 401
       (Unauthorized).

   4.  Processing of the optional "@req.hdr" element is described in
       <a href="#appendix-A">Appendix A</a>.

   5.  The signature provided in MUST be validated as described in
       [<a href="#ref-JWSJCS" title="&quot;Combined JWS and JCS Signature Scheme - Work in progress&quot;">JWSJCS</a>].

<span class="h2"><a class="selflink" name="section-4" href="#section-4">4</a>.  GET and DELETE Requests</span>

   Assume you have an unsigned HTTP request like the following:

     GET /lookup?id=435 HTTP/1.1
     Host: example.com

   Adding a signature to this request would require the following
   enhancements to the URI:

     GET /lookup?id=435&amp;@req.jws=eyJhiJ..VHVIt HTTP/1.1
     Host: example.com

   Notes:

   o  The full URI to the sample above is as follows:

         https://example.com/lookup?id=435&amp;@req.jws=eyJhiJ..VHVIt

      This represents a complete serializable signed request object.



<span class="grey">Rundgren                 Expires August 22, 2019                [Page 5]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-6" id="page-6" href="#page-6" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   o  The argument to "@req.jws" (a detached JWS) was truncated for
      brevity.

   The following subsections detail the operation for requests using an
   HTTP query string component for holding a signature.

<span class="h3"><a class="selflink" name="section-4.1" href="#section-4.1">4.1</a>.  Request Creation</span>

   In order to create a valid request, the steps (and ordering)
   described in this section MUST be adheared to.

   1.  The data to be signed consists of the HTTP method in uppercase
       and the target URI separated by a comma character.  Applied to
       the sample that would yield the following string:

          GET,https://example.com/lookup?id=435

   2.  The resulting string is subsequently converted to UTF-8 [<a href="#ref-UNICODE" title="&quot;The Unicode Standard, Version 10.0.0&quot;">UNICODE</a>]
       which applied to the sample would yield the following byte array,
       here in hexadecimal notation:

          47 45 54 2c 68 74 74 70 73 3a 2f 2f 65 78 61 6d 70 6c 65 2e 63
          6f 6d 2f 6c 6f 6f 6b 75 70 3f 69 64 3d 34 33 35

   3.  The resulting byte array is subsequently encoded in Base64Url
       [<a href="http://tools.ietf.org/html//rfc4648" title="&quot;The Base16, Base32, and Base64 Data Encodings&quot;">RFC4648</a>] notation which applied to the sample would yield the
       following string:

          R0VULGh0dHBzOi8vZXhhbXBsZS5jb20vbG9va3VwP2lkPTQzNQ

       This data is defined as the "JWS Payload" using [<a href="http://tools.ietf.org/html//rfc7515" title="&quot;JSON Web Signature (JWS)&quot;">RFC7515</a>] terms.

   4.  Create a "JWS Protected Header" [<a href="http://tools.ietf.org/html//rfc7515" title="&quot;JSON Web Signature (JWS)&quot;">RFC7515</a>] with algorithm and key
       data adapted for the application.

   5.  If HTTP headers also need to be signed the following steps are
       performed:

       *  Create a SHREQ header object as described in <a href="#appendix-A">Appendix A</a>.

       *  Add the SHREQ header object to the "JWS Protected Header"
          object as follows:

             "crit": ["@req.hdr"],
             "@req.hdr": { the-JSON-header-object }

   6.  Use the "JWS Protected Header", "JWS Payload" and signature key
       to create a detached JWS object as described in



<span class="grey">Rundgren                 Expires August 22, 2019                [Page 6]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-7" id="page-7" href="#page-7" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


       <a href="http://tools.ietf.org/html//rfc7515#appendix-F">Appendix&nbsp;F of [RFC7515]</a>.

   7.  The resulting JWS string is supplied as an argument to an added
       query string "@req.jws" component.  This component is appended to
       the original unsiged request URI prepended by &amp; or ? depending on
       if it is the only query component or not.

<span class="h3"><a class="selflink" name="section-4.2" href="#section-4.2">4.2</a>.  Request Validation</span>

   In addition to normal validation of received data, the following
   steps MUST also be performed:

   1.  Extract the JWS object from the "@req.jws" element in the query
       string.  If the JWS object is missing or malformed the service
       MUST reject the request with an HTTP code 400 (Malformed
       request).

   2.  Extract the "JWS Protected Header" and "JWS Signature" from the
       recieved JWS object.

   3.  If the algorithm or key (optionally) specified in the
       "JWS Protected Header" do not match the service's expectations or
       requirements, reject the request with an HTTP code 401
       (Unauthorized).

   4.  Processing of the optional "@req.hdr" element (featured in the
       "JWS Protected Header") is described in <a href="#appendix-A">Appendix A</a>.

   5.  Recreate HTTP method and the (unsigned) URI from the HTTP headers
       in the request.  Concatenate and convert this data to UTF-8 as
       described in <a href="#section-4.1">Section 4.1</a> to form a "JWS Payload".

   6.  Validate the signature using the recreated "JWS Payload" together
       with the recieved "JWS Protected Header" and "JWS Signature" as
       described in <a href="http://tools.ietf.org/html//rfc7515#appendix-F">Appendix&nbsp;F of [RFC7515]</a>.  If the signature fails to
       validate, reject the request with an HTTP code 401
       (Unauthorized).

<span class="h2"><a class="selflink" name="section-5" href="#section-5">5</a>.  IANA Considerations</span>

   This document has no IANA actions.

<span class="h2"><a class="selflink" name="section-6" href="#section-6">6</a>.  Security Considerations</span>

   Systems implementing this application note are subject to the same
   security considerations as JCS and JWS.





<span class="grey">Rundgren                 Expires August 22, 2019                [Page 7]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-8" id="page-8" href="#page-8" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


<span class="h2"><a class="selflink" name="section-7" href="#section-7">7</a>.  Acknowledgements</span>

   TBD.

<span class="h2"><a class="selflink" name="section-8" href="#section-8">8</a>.  References</span>

<span class="h3"><a class="selflink" name="section-8.1" href="#section-8.1">8.1</a>.  Normative References</span>

   [<a name="ref-JCS" id="ref-JCS">JCS</a>]      A. Rundgren, B. Jordan, S. Erdtman, "JSON Canonicalization
              Scheme - Work in progress", &lt;<a href="https://tools.ietf.org/html/draft-rundgren-json-canonicalization-scheme-05">https://tools.ietf.org/html/</a>
              <a href="https://tools.ietf.org/html/draft-rundgren-json-canonicalization-scheme-05">draft-rundgren-json-canonicalization-scheme-05</a>&gt;.

   [<a name="ref-JWSJCS" id="ref-JWSJCS">JWSJCS</a>]   A. Rundgren, "Combined JWS and JCS Signature Scheme - Work
              in progress", &lt;<a href="https://tools.ietf.org/html/draft-rundgren-jws-jcs-signature-scheme-00">https://tools.ietf.org/html/</a>
              <a href="https://tools.ietf.org/html/draft-rundgren-jws-jcs-signature-scheme-00">draft-rundgren-jws-jcs-signature-scheme-00</a>&gt;.

   [<a name="ref-RFC2119" id="ref-RFC2119">RFC2119</a>]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", <a href="http://tools.ietf.org/html//bcp14">BCP 14</a>, <a href="http://tools.ietf.org/html//rfc2119">RFC 2119</a>,
              DOI 10.17487/RFC2119, March 1997,
              &lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;.

   [<a name="ref-RFC3986" id="ref-RFC3986">RFC3986</a>]  Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform
              Resource Identifier (URI): Generic Syntax", STD 66,
              <a href="http://tools.ietf.org/html//rfc3986">RFC 3986</a>, DOI 10.17487/RFC3986, January 2005,
              &lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;.

   [<a name="ref-RFC4648" id="ref-RFC4648">RFC4648</a>]  Josefsson, S., "The Base16, Base32, and Base64 Data
              Encodings", <a href="http://tools.ietf.org/html//rfc4648">RFC 4648</a>, DOI 10.17487/RFC4648, October 2006,
              &lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;.

   [<a name="ref-RFC7231" id="ref-RFC7231">RFC7231</a>]  Fielding, R., Ed. and J. Reschke, Ed., "Hypertext Transfer
              Protocol (HTTP/1.1): Semantics and Content", <a href="http://tools.ietf.org/html//rfc7231">RFC 7231</a>,
              DOI 10.17487/RFC7231, June 2014,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;.

   [<a name="ref-RFC7493" id="ref-RFC7493">RFC7493</a>]  Bray, T., Ed., "The I-JSON Message Format", <a href="http://tools.ietf.org/html//rfc7493">RFC 7493</a>,
              DOI 10.17487/RFC7493, March 2015,
              &lt;<a href="https://www.rfc-editor.org/info/rfc7493">https://www.rfc-editor.org/info/rfc7493</a>&gt;.

   [<a name="ref-RFC7515" id="ref-RFC7515">RFC7515</a>]  Jones, M., Bradley, J., and N. Sakimura, "JSON Web
              Signature (JWS)", <a href="http://tools.ietf.org/html//rfc7515">RFC 7515</a>, DOI 10.17487/RFC7515, May
              2015, &lt;<a href="https://www.rfc-editor.org/info/rfc7515">https://www.rfc-editor.org/info/rfc7515</a>&gt;.

   [<a name="ref-RFC8174" id="ref-RFC8174">RFC8174</a>]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in <a href="http://tools.ietf.org/html//rfc2119">RFC</a>
              <a href="http://tools.ietf.org/html//rfc2119">2119</a> Key Words", <a href="http://tools.ietf.org/html//bcp14">BCP 14</a>, <a href="http://tools.ietf.org/html//rfc8174">RFC 8174</a>, DOI 10.17487/RFC8174,
              May 2017, &lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;.





<span class="grey">Rundgren                 Expires August 22, 2019                [Page 8]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-9" id="page-9" href="#page-9" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   [<a name="ref-RFC8259" id="ref-RFC8259">RFC8259</a>]  Bray, T., Ed., "The JavaScript Object Notation (JSON) Data
              Interchange Format", STD 90, <a href="http://tools.ietf.org/html//rfc8259">RFC 8259</a>,
              DOI 10.17487/RFC8259, December 2017,
              &lt;<a href="https://www.rfc-editor.org/info/rfc8259">https://www.rfc-editor.org/info/rfc8259</a>&gt;.

   [<a name="ref-UNICODE" id="ref-UNICODE">UNICODE</a>]  The Unicode Consortium, "The Unicode Standard, Version
              10.0.0",
              &lt;<a href="https://www.unicode.org/versions/Unicode10.0.0/">https://www.unicode.org/versions/Unicode10.0.0/</a>&gt;.

<span class="h3"><a class="selflink" name="section-8.2" href="#section-8.2">8.2</a>.  Informal References</span>

   [<a name="ref-AWS" id="ref-AWS">AWS</a>]      Amazon.com, "Signing AWS API Requests",
              &lt;<a href="https://docs.aws.amazon.com/general/latest/gr/signing_aws_api_requests.html">https://docs.aws.amazon.com/general/latest/gr/</a>
              <a href="https://docs.aws.amazon.com/general/latest/gr/signing_aws_api_requests.html">signing_aws_api_requests.html</a>&gt;.

   [<a name="ref-FAPI" id="ref-FAPI">FAPI</a>]     Open ID, "Financial-grade API",
              &lt;<a href="https://openid.net/wg/fapi/">https://openid.net/wg/fapi/</a>&gt;.

   [<a name="ref-HTTPSIG" id="ref-HTTPSIG">HTTPSIG</a>]  M. Cavage, M. Sporny, "Signing HTTP Messages",
              &lt;<a href="https://tools.ietf.org/html/draft-cavage-http-signatures-10">https://tools.ietf.org/html/</a>
              <a href="https://tools.ietf.org/html/draft-cavage-http-signatures-10">draft-cavage-http-signatures-10</a>&gt;.

   [<a name="ref-OBIE" id="ref-OBIE">OBIE</a>]     Open Banking UK, "Open Banking API",
              &lt;<a href="https://www.openbanking.org.uk/">https://www.openbanking.org.uk/</a>&gt;.

   [<a name="ref-REST" id="ref-REST">REST</a>]     Roy Fielding, "Architectural Styles and the Design of
              Network-based Software Architectures",
              &lt;<a href="http://roy.gbiv.com/pubs/dissertation/top.htm">http://roy.gbiv.com/pubs/dissertation/top.htm</a>&gt;.

   [<a name="ref-STET" id="ref-STET">STET</a>]     STET, "PSD2 API V1.4.1", &lt;<a href="https://www.stet.eu/en/psd2/">https://www.stet.eu/en/psd2/</a>&gt;.

<span class="h2"><a class="selflink" name="appendix-A" href="#appendix-A">Appendix A</a>.  Optional SHREQ Headers</span>

   Systems implementing this application note are subject to the same
   security considerations as JCS and JWS.

<span class="h2"><a class="selflink" name="appendix-B" href="#appendix-B">Appendix B</a>.  Other Signed HTTP Request Solutions</span>

   This appendix briefly outlines a few other solutions addressing
   Signed HTTP Requests.

<span class="h3"><a class="selflink" name="appendix-B.1" href="#appendix-B.1">B.1</a>.  Amazon Web Services</span>

   Amazon Web Sevices provides a system for their clients using HTTP
   headers holding security constructs while the digested HTTP body may
   hold any valid media type.  For more information see the [<a href="#ref-AWS" title="&quot;Signing AWS API Requests&quot;">AWS</a>].
   Signatures may also be added to query strings in a similar fashion to
   <a href="#section-4">Section 4</a>.



<span class="grey">Rundgren                 Expires August 22, 2019                [Page 9]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-10" id="page-10" href="#page-10" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


<span class="h3"><a class="selflink" name="appendix-B.2" href="#appendix-B.2">B.2</a>.  HTTP Signatures</span>

   HTTP Signatures is a system using HTTP headers holding security
   constructs while the (optional) digested HTTP body may hold any valid
   media type.  This scheme has been adopted by the French Open Banking
   API [<a href="#ref-STET" title="&quot;PSD2 API V1.4.1&quot;">STET</a>].  For more information see the Internet draft [<a href="#ref-HTTPSIG" title="&quot;Signing HTTP Messages&quot;">HTTPSIG</a>].
   HTTP Signatures also supports signed response data.

<span class="h3"><a class="selflink" name="appendix-B.3" href="#appendix-B.3">B.3</a>.  Open Banking (UK)</span>

   The current (3.1) version of the Open Banking API [<a href="#ref-OBIE" title="&quot;Open Banking API&quot;">OBIE</a>] use a scheme
   where a dedicated HTTP header holds a detached JWS signature covering
   a clear text JSON message in the HTTP body:

     POST /transact/pay HTTP/1.1
     Host: example.com
     Content-Type: application/json
     x-jws-signature: eyJhbGciOiJSUzI1N..SD7xMbpL-2QgwUsAlMGzw
     Content-Length: 2765

     {
        "something": "data",

            Additional application specific properties

     }

   Notes:

   o  The HTTP URI, method and headers are unsigned.

   o  The signature argument (a JWS) was truncated for brevity.

<span class="h3"><a class="selflink" name="appendix-B.4" href="#appendix-B.4">B.4</a>.  Financial API</span>

   The current version (Draft 06) of the financial API [<a href="#ref-FAPI" title="&quot;Financial-grade API&quot;">FAPI</a>] use a
   scheme where the payload is signed using JWS in Base64Url [<a href="http://tools.ietf.org/html//rfc4648" title="&quot;The Base16, Base32, and Base64 Data Encodings&quot;">RFC4648</a>]
   mode:

     POST /transact/pay HTTP/1.1
     Host: example.com
     Content-Type: application/jws
     Content-Length: 1288

     eyJhbGcRjIn0.ew0KICJfds56gty5ypc3MiOiA.2QgwUsA565656lMGzw

   Notes:




<span class="grey">Rundgren                 Expires August 22, 2019               [Page 10]</span></pre>
<hr class='noprint' style='width: 96ex;' align='left'/><!--NewPage--><pre class='newpage'><a name="page-11" id="page-11" href="#page-11" class="invisible"> </a>
<span class="grey">Internet-Draft     <a href="http://tools.ietf.org/html//draft-rundgren-signed-http-requests">draft-rundgren-signed-http-requests</a>     February 2019</span>


   o  The HTTP URI, method and headers are unsigned.

   o  The JWS signature was truncated for brevity.




Author's Address

   Anders Rundgren
   Independent
   Montpellier
   France

   Email: anders.rundgren.net@gmail.com
   URI:   <a href="https://www.linkedin.com/in/andersrundgren/">https://www.linkedin.com/in/andersrundgren/</a>



































Rundgren                 Expires August 22, 2019               [Page 11]

</pre><br />
    <span class="noprint"><small><small>Html markup produced by rfcmarkup 1.129b, available from
      <a href="https://tools.ietf.org/tools/rfcmarkup/">https://tools.ietf.org/tools/rfcmarkup/</a>
    </small></small></span>
  </div>
</body>
</html>
